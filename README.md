## ReadMe - Guidance for Training an AWS DeepRacer Model Using Amazon SageMaker  

**Table of Contents**

* Overview
* Cost
* Prerequisites
* Cleanup

**Overview**

The AWS DeepRacer console is optimized to provide a user-friendly introduction to reinforcement learning to developers new to machine learning. As developers go deeper in their machine learning journey, they need more control and more options for further tuning and refining their reinforcement learning models for racing with AWS DeepRacer. This guidance is intended to provide developers with a deep dive on how they can use an Amazon SageMaker Notebook instance to directly train and evaluate DeepRacer models with full control, including: augmenting the simulation environment, manipulating inputs to the neural network, modifying neural network architecture, running distributed rollouts, debugging their model.

**Cost**

You are responsible for the cost of the AWS services used while running this Guidance.

As of 10/30/2023, the cost for running this guidance with the default settings in the US East (N. Virginia) is approximately $31.27 per month for training  5 models, 1 hour each, with training spread across 5 days. Remember to shut down your SageMaker Notebook instance each day.


| Service | Assumptions | Cost Per Month |
| ------------- | ------------- | ------------- | 
| Amazon SageMaker Studio Notebook |	1 Notebook Instance used for 25 hours	| $9.97 |
| Amazon SageMaker Training | 5 jobs per month x 1 instance per job x 1 hour per job, 32 GB SSD storage |	$6.87 |
| AWS Robo Maker	25 Simulation Unit Hours (SU-Hours) |	$10 |
| Amazon CloudWatch |	5GB logs storage |	$2.52 |
| Amazon Simple Storage Service	| 10GB data, 1,000 PUT, 1000 GET requests |	$0.26 |
| Amazon Kinesis Video Streams |	5 hours data Ingestion per day, 5 days storage |	$1.65 |
| VPC |	All traffic is flowing through a Gateway VPC Endpoint |	0 |
|	| | 31.27 |

**Prerequisites (required)**

This guidance is targeted towards those familiar with the AWS Console and AWS DeepRacer Service. The users are expected to have a basic understanding of AWS DeepRacer, SageMaker, RoboMaker services, and general Machine Learning concepts. It guides users to utilize these services directly to train, and tune their models to a higher level of performance. It should be run in US East N.Virginia region.


**Architecture Overview**

<img width="676" alt="architecture-for-training-an-aws-deepracer-model-using-amazon-sagemaker" src="https://github.com/aws-solutions-library-samples/guidance-for-training-an-aws-deepracer-model-using-amazon-sagemaker/assets/58491864/86a36774-5b60-4352-bd76-57634ec38c88">

**Deployment Steps (required)**

1. User logs in to AWS account, creates an Amazon SageMaker Notebook instance to train a Reinforcement Learning (RL) model.
1. Amazon SageMaker Notebook stores all files required for the training and evaluation jobs in Amazon Simple Storage Service (S3) and as images in Amazon Elastic Container Registry (Amazon ECR).
1. Amazon SageMaker downloads images from Amazon ECR and starts a model training job.
1. AWS RoboMaker downloads images from Amazon ECR and creates a racing simulation environment for AWS DeepRacer. 
1. AWS RoboMaker starts data generation for model training. Training data generated by is a collection of tuples comprising of agent initial state, action, new state, reward.
1. AWS RoboMaker sends pre configured batches of these tuples called iterations to Amazon S3 and writes a key to Amazon SageMaker container.
1. Amazon SageMaker Training picks up the data file from Amazon S3 based on the key and trains the model on this dataset. Amazon SageMaker uploads the next version of the model to Amazon S3 that is picked up by AWS Robomaker.
1. Steps 5 to 7 are iterative. It ends when the training job duration ends. Training job duration can be configured in Amazon Sagemaker Notebook code using parameter job_duration_in_seconds.
1. AWS RoboMaker streams live training and evaluation jobs to Amazon Kinesis Video Streams. Users can view model training and evaluation in real time on Amazon Kinesis Video Streams.
1. All training logs, evaluation logs, service calls, and operational metrics can be viewed in Amazon CloudWatch console.













## Developer Tools

[Log Analyzer and Visualizations](https://github.com/aws-samples/aws-deepracer-workshops/tree/master/log-analysis/)

## License Summary

This sample code is made available under a modified MIT license. See the LICENSE file.
